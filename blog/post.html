<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- Latest compiled and minified CSS -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="../css/style.css" />
        <link rel="stylesheet" href="blog-style.css" />

        <!-- KaTeX for LaTeX math rendering -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
            integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
            crossorigin="anonymous"
        />
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
            integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
            crossorigin="anonymous"
        ></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
            integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
            crossorigin="anonymous"
        ></script>

        <!-- Marked for Markdown parsing -->
        <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>

        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="../favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="../favicon-16x16.png"
        />
        <link rel="manifest" href="../site.webmanifest" />
        <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5" />
        <meta name="msapplication-TileColor" content="#da532c" />
        <meta name="theme-color" content="#ffffff" />
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script async defer data-website-id="1fb361e4-6305-4100-892d-9a71732ad03f"
        src="https://ag.arunavgupta.com/a.js"
        data-host-url="https://ag.arunavgupta.com"
        data-auto-track="true"></script>
        <title>Blog Post - Arunav Gupta</title>
    </head>

    <body class="container justify-content-center px-4">
        <nav class="blog-nav mb-4">
            <a href="../index.html" class="nav-link">Home</a>
            <span class="mx-2">|</span>
            <a href="index.html" class="nav-link">‚Üê Back to Blog</a>
        </nav>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <article class="blog-post-content">
                    <div id="post-header" class="text-center mb-5">
                        <!-- Post header will be loaded here -->
                    </div>
                    <div id="post-content">
                        <!-- Post content will be loaded here -->
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading blog post...</p>
                        </div>
                    </div>
                </article>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                loadBlogPost();
            });

            function getUrlParameter(name) {
                const params = new URLSearchParams(window.location.search);
                return params.get(name) || "";
            }

            function loadBlogPost() {
                const postId = getUrlParameter("id");

                if (!postId) {
                    $("#post-content").html(
                        "<p>Error: No blog post specified.</p>",
                    );
                    return;
                }

                // Load manifest to get post metadata
                $.getJSON("manifest.json", function (manifest) {
                    const post = manifest.find((p) => p.id === postId);

                    if (!post) {
                        $("#post-content").html(
                            "<p>Error: Blog post not found.</p>",
                        );
                        return;
                    }

                    // Update page title
                    document.title = post.title + " - Arunav Gupta";

                    // Create post header
                    const formattedDate = formatDate(post.date);
                    const tagsHtml = post.tags
                        .map((tag) => `<span class="blog-tag">${tag}</span>`)
                        .join(" ");

                    $("#post-header").html(`
                    <h1>${post.title}</h1>
                    <p class="lead">${post.subheading}</p>
                    <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                        <span class="text-muted">${formattedDate}</span>
                        <div>${tagsHtml}</div>
                    </div>
                `);

                    // Load and render markdown content
                    $.get(post.path, function (markdownContent) {
                        // Remove the first line if it's a title (starts with #)
                        const lines = markdownContent.split("\n");
                        if (
                            lines.length > 0 &&
                            lines[0].trim().startsWith("#")
                        ) {
                            // Remove the first line (title) and any following empty lines
                            let startIndex = 1;
                            while (
                                startIndex < lines.length &&
                                lines[startIndex].trim() === ""
                            ) {
                                startIndex++;
                            }
                            markdownContent = lines
                                .slice(startIndex)
                                .join("\n");
                        }

                        // Configure marked with syntax highlighting and math support
                        marked.setOptions({
                            breaks: true,
                            gfm: true,
                            highlight: function (code, lang) {
                                if (lang && hljs.getLanguage(lang)) {
                                    try {
                                        return hljs.highlight(code, {
                                            language: lang,
                                        }).value;
                                    } catch (err) {
                                        console.warn(
                                            "Syntax highlighting failed for language:",
                                            lang,
                                            err,
                                        );
                                    }
                                }
                                // Fallback to auto-detection if language not specified or recognized
                                try {
                                    return hljs.highlightAuto(code).value;
                                } catch (err) {
                                    console.warn(
                                        "Auto syntax highlighting failed:",
                                        err,
                                    );
                                    return code; // Return plain code if highlighting fails
                                }
                            },
                        });

                        const htmlContent = marked.parse(markdownContent);
                        $("#post-content").html(htmlContent);

                        // Apply syntax highlighting to code blocks
                        $("#post-content pre code").each(function (i, block) {
                            hljs.highlightElement(block);
                        });

                        // Render LaTeX math
                        renderMathInElement(
                            document.getElementById("post-content"),
                            {
                                delimiters: [
                                    { left: "$$", right: "$$", display: true },
                                    { left: "$", right: "$", display: false },
                                    {
                                        left: "\\[",
                                        right: "\\]",
                                        display: true,
                                    },
                                    {
                                        left: "\\(",
                                        right: "\\)",
                                        display: false,
                                    },
                                ],
                            },
                        );
                    }).fail(function () {
                        $("#post-content").html(
                            "<p>Error loading blog post content.</p>",
                        );
                    });
                }).fail(function () {
                    $("#post-content").html(
                        "<p>Error loading blog manifest.</p>",
                    );
                });
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                };
                return date.toLocaleDateString("en-US", options);
            }
        </script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
